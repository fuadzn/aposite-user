<?php if (!defined('BASEPATH')) exit('No direct script access allowed');

require_once(APPPATH . 'controllers/Secure_area.php');
class Sso extends Secure_area
{
    public function __construct()
    {
        parent::__construct();
        $this->load->model('admin/M_user', '', TRUE);
		$this->load->model('admin/M_sekolah', '', TRUE);
		$this->load->model('admin/M_menu', '', TRUE);
		$this->load->model('admin/M_role', '', TRUE);
		$this->load->model('admin/Appconfig', '', TRUE);

    }
    
    function index()
    {
        $data['title'] = 'Members';
        $data['provinsi'] = $this->M_sekolah->get_provinsi()->result();
        $this->load->view('sso/user_sso', $data);
    }

    public function show_data_siswa()
    {
        $roleid = $this->load->get_var("user_info")->roleid;
            $line  = array();
            $line2 = array();
            $row2  = array();
            $hasil = $this->M_sekolah->get_sso()->result();
            $i = 1;
            foreach ($hasil as $value) {
                $row2['no'] = $i++;
                $row2['email'] = $value->email;
                $row2['username'] = $value->username;
                $row2['display_name'] = $value->display_name;
                $row2['role'] = $value->role;
                $row2['status'] = $value->status;
                $row2['last_login'] = $value->last_login;

                $line2[] = $row2;
            }
            $line['data'] = $line2;

            echo json_encode($line);
    }

    // public function find_sso()
    // {
    //     $ch = curl_init();

	// 	curl_setopt($ch, CURLOPT_URL, "sso.teratai.id/kc-admin/users");
	// 	curl_setopt($ch, CURLOPT_POST, 1);
	// 	curl_setopt($ch, CURLOPT_POSTFIELDS, "email=" . $this->input->post(''));

	// 	curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

	// 	$result = curl_exec($ch);
	// 	$httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
	// 	$response = ($httpCode == 200) ? true : false;

    //     curl_close($ch);
        
    //         if (isset($_GET['term'])) {
    //             $result = $this->blog_model->search_blog($_GET['term']);
    //             if (count($result) > 0) {
    //             foreach ($result as $row)
    //                 $arr_result[] = $row->blog_title;
    //                 echo json_encode($arr_result);
    //             }
    //         }
    // }

    public function get_data_kota()
	{
		$nama_provinsi = $this->input->post('nama_provinsi');
		$data = $this->M_sekolah->get_kota($nama_provinsi)->result();
		$kota = '';
		if (sizeof((array) $data) > 0) {
			$kota .= "<option value=''>-=Pilih Kota=-</option>";
			foreach ($data as $row) {
				$kota .= "<option value='" . $row->id_region . "'>$row->nama_region</option>";
			}
		}
		if ($kota != "") {
			echo json_encode(array('success' => true, 'data' => $kota));
		} else {
			echo json_encode(array('success' => false, 'data' => '<option value="">-=Data Kota Kosong=-</option>'));
        }
    }

    public function get_wilayah2()
    {
        $json = [];

        $this->load->database();


        if (!empty($this->input->get("q"))) {
            // $this->db->like('nama', $this->input->get("q"));
            // $query = $this->db->select('id,id_kecamatan,nama')
            // 			->limit(10)
            // 			->get("kelurahandesa");
            // $this->db->like('nama_region', $title, 'both');
            // $this->db->order_by('nama_region', 'ASC');
            // $this->db->limit(10);
            // return $this->db->get('master_region')->result();
            $query = $this->db
                ->like('nama_region', $this->input->get("q"))
                ->order_by('nama_region', 'ASC')
                ->select('*')->limit(50, 0)->get('master_region');
            $json = $query->result();
        }


        echo json_encode($json);
    }

}
